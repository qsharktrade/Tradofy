<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Tradofy - Trading Platform</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&display=swap" rel="stylesheet" />
<style>
  body {
    margin: 0;
    font-family: 'Orbitron', sans-serif;
    background: #0f0f0f;
    color: white;
  }
  header {
    padding: 15px;
    background: #1a1a1a;
    text-align: center;
    font-size: 24px;
    color: limegreen;
    box-shadow: 0 0 10px lime;
  }
  .balance-box {
    margin: 20px;
    text-align: center;
    font-size: 20px;
    color: #00ff99;
  }
  #chart {
    height: 300px;
    margin: 0 20px;
    border-radius: 10px;
    overflow: hidden;
    border: 2px solid limegreen;
    background: #222;
    position: relative;
  }
  .trade-controls {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin: 20px;
  }
  .trade-controls select, .trade-controls button {
    padding: 12px;
    font-size: 16px;
    border-radius: 8px;
    border: none;
  }
  .trade-controls button {
    background: linear-gradient(135deg, #00ff99, #00ccff);
    color: #000;
    font-weight: bold;
    cursor: pointer;
    transition: transform 0.2s, box-shadow 0.2s;
    box-shadow: 0 4px 15px rgba(0, 255, 153, 0.4);
  }
  .trade-controls button:hover {
    transform: scale(1.05);
    box-shadow: 0 6px 20px rgba(0, 255, 153, 0.6);
  }
  .action-buttons {
    display: flex;
    justify-content: space-around;
    margin: 20px;
  }
  .action-buttons button {
    background: linear-gradient(135deg, #1aff66, #00ffcc);
    padding: 12px 24px;
    border: none;
    border-radius: 10px;
    font-size: 18px;
    font-weight: bold;
    color: #000;
    box-shadow: 0 4px 15px rgba(26, 255, 102, 0.5);
    cursor: pointer;
    transition: transform 0.2s, box-shadow 0.2s;
  }
  .action-buttons button:hover {
    transform: scale(1.05);
    box-shadow: 0 6px 20px rgba(26, 255, 102, 0.7);
  }
  .admin-link {
    text-align: center;
    margin: 30px;
    font-size: 18px;
    cursor: pointer;
    color: limegreen;
    text-decoration: underline;
  }
  /* Entry marker arrow below chart center */
  .entry-marker {
    position: absolute;
    bottom: 10px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 28px;
    color: limegreen;
    display: none;
    pointer-events: none;
    user-select: none;
    animation: bounce 1.5s infinite;
    z-index: 10;
  }
  @keyframes bounce {
    0%, 100% { transform: translateX(-50%) translateY(0); }
    50% { transform: translateX(-50%) translateY(-10px); }
  }
</style>
</head>
<body>
<header>Tradofy</header>

<div class="balance-box">
  Balance: <span id="balance">à§³1000</span>
</div>

<div id="chart">
  <div class="entry-marker" id="entryMarker">â–²</div>
</div>

<div class="trade-controls">
  <label for="timeSelect">Select Trade Duration:</label>
  <select id="timeSelect">
    <option value="5">5 Seconds</option>
    <option value="15">15 Seconds</option>
    <option value="30">30 Seconds</option>
    <option value="60">1 Minute</option>
    <option value="180">3 Minutes</option>
    <option value="300">5 Minutes</option>
  </select>
  <button onclick="placeTrade('call')">CALL (Up)</button>
  <button onclick="placeTrade('put')">PUT (Down)</button>
</div>

<div class="action-buttons">
  <button onclick="alert('Deposit Page Coming Soon')">Deposit</button>
  <button onclick="alert('Withdraw Page Coming Soon')">Withdraw</button>
</div>

<div class="admin-link" onclick="location.href='admin.html'">Go to Admin Panel</div>

<!-- Lightweight Charts CDN -->
<script src="https://unpkg.com/lightweight-charts@3.7.0/dist/lightweight-charts.standalone.production.js"></script>
<script>
  let userBalance = 1000;
  const balanceDisplay = document.getElementById('balance');
  const entryMarker = document.getElementById('entryMarker');

  function updateBalanceDisplay() {
    balanceDisplay.innerText = `à§³${userBalance.toFixed(2)}`;
  }
  updateBalanceDisplay();

  // Create chart
  const chart = LightweightCharts.createChart(document.getElementById('chart'), {
    width: document.getElementById('chart').clientWidth,
    height: 300,
    layout: {
      backgroundColor: '#222',
      textColor: 'white',
    },
    grid: {
      vertLines: { color: '#444' },
      horzLines: { color: '#444' },
    },
    crosshair: {
      mode: LightweightCharts.CrosshairMode.Normal,
    },
    priceScale: {
      borderColor: '#555',
    },
    timeScale: {
      borderColor: '#555',
      timeVisible: true,
      secondsVisible: false,
    },
  });

  const candleSeries = chart.addCandlestickSeries({
    upColor: '#00ff00',
    downColor: '#ff0000',
    borderVisible: false,
    wickVisible: true,
    borderColor: '#00ff00',
    wickColor: '#00ff00',
  });

  // Initial candles data (simulate last 30 mins)
  let lastTimestamp = Math.floor(Date.now() / 1000);
  let candles = [];

  function generateInitialCandles() {
    let lastClose = 100;
    const generated = [];
    for (let i = 30; i >= 0; i--) {
      const time = lastTimestamp - i * 60; // 1 min intervals
      let open = lastClose;
      let close = open + (Math.random() - 0.5) * 4;
      let high = Math.max(open, close) + Math.random() * 2;
      let low = Math.min(open, close) - Math.random() * 2;
      generated.push({
        time: time,
        open: +open.toFixed(2),
        high: +high.toFixed(2),
        low: +low.toFixed(2),
        close: +close.toFixed(2),
      });
      lastClose = close;
    }
    return generated;
  }

  candles = generateInitialCandles();
  candleSeries.setData(candles);

  // Update chart width on resize
  window.addEventListener('resize', () => {
    chart.applyOptions({ width: document.getElementById('chart').clientWidth });
  });

  // This variable controls how often we generate a new candle in seconds
  let candleDuration = 60; // default 60 seconds (1 min)

  // We will keep track of seconds passed since last candle
  let secondsSinceLastCandle = 0;

  // Function to generate a new candle based on last candle
  function generateNewCandle() {
    const lastCandle = candles[candles.length - 1];
    const newTime = lastCandle.time + candleDuration;

    let open = lastCandle.close;
    let close = open + (Math.random() - 0.5) * 4;
    let high = Math.max(open, close) + Math.random() * 2;
    let low = Math.min(open, close) - Math.random() * 2;

    return {
      time: newTime,
      open: +open.toFixed(2),
      high: +high.toFixed(2),
      low: +low.toFixed(2),
      close: +close.toFixed(2),
    };
  }

  // Set interval every 1 second to simulate live chart
  setInterval(() => {
    secondsSinceLastCandle++;

    if (secondsSinceLastCandle >= candleDuration) {
      // Time to generate a new candle
      secondsSinceLastCandle = 0;
      candles.shift(); // remove oldest candle
      candles.push(generateNewCandle());
      candleSeries.setData(candles);
    }
    // You can also update chart or do minor updates here if needed
  }, 1000);

  function placeTrade(direction) {
    const duration = parseInt(document.getElementById('timeSelect').value);
    candleDuration = duration;  // update candleDuration dynamically

    const tradeAmount = 100;

    if(userBalance < tradeAmount) {
      alert('Insufficient Balance!');
      return;
    }

    userBalance -= tradeAmount;
    updateBalanceDisplay();

    // Show entry marker
    entryMarker.style.display = 'block';

    setTimeout(() => {
      entryMarker.style.display = 'none';

      const won = Math.random() < 0.85;
      if(won) {
        const profit = tradeAmount * 1.8;
        userBalance += profit;
        alert(`ðŸŽ‰ You WON! Profit: à§³${profit.toFixed(2)}`);
      } else {
        alert(`ðŸ˜ž You LOST! Amount: à§³${tradeAmount.toFixed(2)}`);
      }
      updateBalanceDisplay();
    }, duration * 1000);
  }
</script>
</body>
</html>
